<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Controle Financeiro</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .section { margin-bottom: 30px; border: 1px solid #ccc; padding: 20px; border-radius: 5px; }
        input, select, button { margin: 5px; padding: 8px; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
    </style>
</head>
<body>
    <div class="container">
        <div class="section">
            <h2>Gerenciar Categorias</h2>
            <input type="text" id="categoryName" placeholder="Nova categoria">
            <select id="categoryType">
                <option value="income">Receita</option>
                <option value="expense">Despesa</option>
            </select>
            <button onclick="addCategory()">Adicionar Categoria</button>
            <div id="categoriesList"></div>
        </div>

        <div class="section">
            <h2>Adicionar Transação</h2>
            <select id="transactionCategory"></select>
            <input type="number" id="transactionAmount" placeholder="Valor">
            <input type="month" id="transactionMonth">
            <button onclick="addTransaction()">Adicionar</button>
        </div>

        <div class="section">
            <h2>Saldo Mensal</h2>
            <div id="balance"></div>
        </div>
    </div>

    <script>
        // Configuração do Firebase
const firebaseConfig = {
  apiKey: "AIzaSyCgSkYIvenfEzyjef50OD01Ox9et-nyBMo",
  authDomain: "fluxo-6d716.firebaseapp.com",
  databaseURL: "https://fluxo-6d716-default-rtdb.firebaseio.com",
  projectId: "fluxo-6d716",
  storageBucket: "fluxo-6d716.firebasestorage.app",
  messagingSenderId: "761253335013",
  appId: "1:761253335013:web:44c30372a4749203a3690c"
};
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // Carregar categorias
        function loadCategories() {
            const categoriesRef = database.ref('categories');
            categoriesRef.on('value', (snapshot) => {
                const categories = snapshot.val() || {};
                const select = document.getElementById('transactionCategory');
                select.innerHTML = '';
                
                let categoriesList = '<h3>Categorias Existentes</h3>';
                for (const key in categories) {
                    categoriesList += `
                        <div>
                            ${categories[key].name} (${categories[key].type})
                            <button onclick="editCategory('${key}')">Editar</button>
                            <button onclick="deleteCategory('${key}')">Excluir</button>
                        </div>
                    `;
                    
                    const option = document.createElement('option');
                    option.value = key;
                    option.textContent = categories[key].name;
                    select.appendChild(option);
                }
                document.getElementById('categoriesList').innerHTML = categoriesList;
            });
        }

        // Adicionar categoria
        function addCategory() {
            const name = document.getElementById('categoryName').value;
            const type = document.getElementById('categoryType').value;
            
            database.ref('categories').push({
                name: name,
                type: type
            });
        }

        // Editar categoria
        function editCategory(key) {
            const newName = prompt('Novo nome da categoria:');
            if (newName) {
                database.ref('categories/' + key).update({
                    name: newName
                });
            }
        }

        // Excluir categoria
        function deleteCategory(key) {
            if (confirm('Tem certeza que deseja excluir esta categoria?')) {
                database.ref('categories/' + key).remove();
            }
        }

        // Adicionar transação
        function addTransaction() {
            const categoryKey = document.getElementById('transactionCategory').value;
            const amount = parseFloat(document.getElementById('transactionAmount').value);
            const month = document.getElementById('transactionMonth').value;

            database.ref('transactions').push({
                category: categoryKey,
                amount: amount,
                month: month,
                date: firebase.database.ServerValue.TIMESTAMP
            });
        }

        // Calcular saldo
        function calculateBalance() {
            const transactionsRef = database.ref('transactions');
            transactionsRef.on('value', async (snapshot) => {
                const transactions = snapshot.val() || {};
                const categories = await database.ref('categories').once('value').then(snap => snap.val() || {});

                const balance = {};

                for (const key in transactions) {
                    const transaction = transactions[key];
                    const category = categories[transaction.category];
                    const month = transaction.month;

                    if (!balance[month]) {
                        balance[month] = { income: 0, expense: 0, total: 0 };
                    }

                    if (category.type === 'income') {
                        balance[month].income += transaction.amount;
                    } else {
                        balance[month].expense += transaction.amount;
                    }

                    balance[month].total = balance[month].income - balance[month].expense;
                }

                // Exibir saldo
                let balanceHTML = '<table><tr><th>Mês</th><th>Receitas</th><th>Despesas</th><th>Saldo</th></tr>';
                for (const month in balance) {
                    balanceHTML += `
                        <tr>
                            <td>${month}</td>
                            <td>R$ ${balance[month].income.toFixed(2)}</td>
                            <td>R$ ${balance[month].expense.toFixed(2)}</td>
                            <td>R$ ${balance[month].total.toFixed(2)}</td>
                        </tr>
                    `;
                }
                balanceHTML += '</table>';
                document.getElementById('balance').innerHTML = balanceHTML;
            });
        }

        // Inicializar
        loadCategories();
        calculateBalance();
    </script>
</body>
</html>
